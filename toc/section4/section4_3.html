<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>4.3. Methods and tools for removing ring artifacts &#8212; Algotom&#39;s documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic_mod.css?v=9b2032db" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <script src="../../_static/js/petite-vue.js"></script>
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="4.4. Comparison of ring removal methods on challenging sinograms" href="section4_4.html" />
    <link rel="prev" title="4.2. Exploring raw data and making use of the input-output module" href="section4_2.html" /> 
  </head><body data-dark_mode_code_blocks="true">

<div id="top_nav">
    

    <nav>
        
            
        

        <p id="toggle_sidebar">
            <a href="#" title="Toggle sidebar">|||</a>
        </p>
        <h1><a href="../../index.html" title="Go to homepage">Algotom's documentation</a></h1>

        <a id="mode_toggle" href="#" @click.prevent="handleClick" :title="mode">
    <template v-if="mode == 'light'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_light"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M67.48,18.073c1.913,-1.912 1.913,-5.018 0,-6.931c-1.912,-1.912 -5.018,-1.912 -6.931,0l-6.798,6.799c-1.912,1.912 -1.912,5.018 0,6.931c1.913,1.912 5.018,1.912 6.931,-0l6.798,-6.799Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.728,61.108c1.912,-1.913 1.912,-5.018 -0,-6.931c-1.913,-1.913 -5.019,-1.913 -6.931,-0l-6.799,6.798c-1.912,1.913 -1.912,5.019 0,6.931c1.913,1.913 5.019,1.913 6.931,0l6.799,-6.798Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.682,54.177c-1.913,-1.913 -5.018,-1.913 -6.931,-0c-1.912,1.913 -1.912,5.018 0,6.931l6.798,6.798c1.913,1.913 5.019,1.913 6.931,0c1.913,-1.912 1.913,-5.018 0,-6.931l-6.798,-6.798Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M4.901,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,-0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M18.929,11.142c-1.912,-1.912 -5.018,-1.912 -6.931,0c-1.912,1.913 -1.912,5.019 0,6.931l6.799,6.799c1.912,1.912 5.018,1.912 6.931,-0c1.912,-1.913 1.912,-5.019 -0,-6.931l-6.799,-6.799Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.108,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c-0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c-0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'dark'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_dark"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.901,2.196 -4.901,4.901c0,2.705 2.197,4.901 4.901,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.662,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.989,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.732,61.103c1.91,-1.91 1.91,-5.011 0,-6.921l-0.009,-0.01c-1.91,-1.91 -5.012,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.909,1.91 5.011,1.91 6.92,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.672,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.52,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l-0,-0.01c-0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.901,2.196 -4.901,4.901c0,2.704 2.197,4.9 4.901,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.73,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 -0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.098,34.623c-2.699,0 -4.891,2.192 -4.891,4.892l-0,0.019c-0,2.699 2.192,4.891 4.891,4.891c2.7,0 4.892,-2.192 4.892,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.892,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'darkest'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_darkest"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><path d="M39.315,23.791c8.684,-0 15.734,7.05 15.734,15.733c0,8.684 -7.05,15.734 -15.734,15.734c-8.683,0 -15.733,-7.05 -15.733,-15.734c-0,-8.683 7.05,-15.733 15.733,-15.733Zm0,4.737c6.069,0 10.997,4.927 10.997,10.996c-0,6.069 -4.928,10.996 -10.997,10.996c-6.068,0 -10.996,-4.927 -10.996,-10.996c0,-6.069 4.928,-10.996 10.996,-10.996Z" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.216,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.9,2.196 -4.9,4.901c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.666,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.99,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.737,61.103c1.909,-1.91 1.909,-5.011 -0,-6.921l-0.01,-0.01c-1.91,-1.91 -5.011,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.91,1.91 5.011,1.91 6.921,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.676,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.524,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l0,-0.01c0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.216,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901c-0,2.704 2.196,4.9 4.9,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.734,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.103,34.623c-2.7,0 -4.892,2.192 -4.892,4.892l-0,0.019c-0,2.699 2.192,4.891 4.892,4.891c2.699,0 4.891,-2.192 4.891,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.891,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>
</a>

<script>
(function() {
    const LOCAL_STORAGE_KEY = 'piccoloThemeMode'

    var initialMode = localStorage.getItem(LOCAL_STORAGE_KEY)

    if (initialMode) {
        // Make sure the value in local storage is valid
        if (['light', 'dark', 'darkest'].indexOf(initialMode) == -1) {
            initialMode = 'light'
            localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
        }
    } else {
        // Check if the client prefers dark mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            initialMode = 'dark'
        } else {
            initialMode = 'light'
        }
        localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
    }

    document.documentElement.dataset.mode = initialMode

    PetiteVue.createApp({
        'mode': initialMode,
        handleClick() {
            let currentMode = this.mode

            if (currentMode == 'light') {
                this.mode = 'dark'
            } else if (currentMode == 'dark') {
                this.mode = 'darkest'
            } else if (currentMode == 'darkest') {
                this.mode = 'light'
            }

            document.documentElement.dataset.mode = this.mode
            localStorage.setItem(LOCAL_STORAGE_KEY, this.mode)

            console.log(this.mode)
        }
    }).mount('#mode_toggle')
})()
</script>
            <p class="mobile_search_link">
                <a href="../../search.html" title="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 65 64" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2">
                        <path d="M14.873 40.009c-2.315-3.943-3.642-8.532-3.642-13.429C11.231 11.91 23.141 0 37.811 0s26.58 11.91 26.58 26.58-11.91 26.58-26.58 26.58a26.44 26.44 0 0 1-14.277-4.161L9.739 62.794a3.12 3.12 0 0 1-4.413 0L.913 58.382c-1.217-1.218-1.217-3.196 0-4.413l13.96-13.96zM37.811 8.054c10.225 0 18.526 8.301 18.526 18.526s-8.301 18.526-18.526 18.526-18.526-8.301-18.526-18.526S27.586 8.054 37.811 8.054z" fill="#fff" />
                    </svg>
                </a>
            </p>
        

        <div class="searchbox_wrapper">
            
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
    </nav>
</div>

    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../section1.html">1. Basic tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../section2.html">2. Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../section3.html">3. Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../section4.html">4. Demonstrations</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="section4_1.html">4.1. Setting up a Python workspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="section4_2.html">4.2. Exploring raw data and making use of the input-output module</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.3. Methods and tools for removing ring artifacts</a></li>
<li class="toctree-l2"><a class="reference internal" href="section4_4.html">4.4. Comparison of ring removal methods on challenging sinograms</a></li>
<li class="toctree-l2"><a class="reference internal" href="section4_5.html">4.5. Complete workflow for processing tomographic data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../section5.html">5. Technical notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../section6.html">6. Update notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">7. API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits.html">8. Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../highlights.html">9. Highlights</a></li>
<li class="toctree-l1"><a class="reference internal" href="../links.html">10. Quick links</a></li>
</ul>

        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="methods-and-tools-for-removing-ring-artifacts">
<span id="section4-3"></span><h1><span class="section-number">4.3. </span>Methods and tools for removing ring artifacts<a class="headerlink" href="#methods-and-tools-for-removing-ring-artifacts" title="Link to this heading">¶</a></h1>
<p>Algotom provides improved implementations of many methods for removing ring artifacts;
which were published previously by the same author in <a class="reference external" href="https://sarepy.readthedocs.io/">Sarepy</a>;
to be easier to use and customize. More than that, there are many tools for users to
design their own removal methods.</p>
<p>Note that ring artifacts in a reconstructed image are corresponding to stripe artifacts in
the sinogram image or the polar-transformed image. Most of ring removal methods are actually
stripe removal methods under the surface.</p>
<blockquote>
<div><figure class="align-center" id="fig-4-3-1" style="width: 70%">
<img alt="../../_images/fig_4_3_1.jpg" src="../../_images/fig_4_3_1.jpg" />
<figcaption>
<p><span class="caption-number">Fig. 4.3.1 </span><span class="caption-text">Ring removal methods working on sinogram image, known as pre-processing methods.
(a) Sinogram before correction. (b) Sinogram after correction. (c) Reconstructed
image from sinogram (a). (d) Reconstructed image from sinogram (b).</span><a class="headerlink" href="#fig-4-3-1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-center" id="fig-4-3-2" style="width: 70%">
<img alt="../../_images/fig_4_3_2.jpg" src="../../_images/fig_4_3_2.jpg" />
<figcaption>
<p><span class="caption-number">Fig. 4.3.2 </span><span class="caption-text">Ring removal methods working on polar-transformed image, known as post-processing methods.
(a) Reconstructed image before correction. (b) Polar transformation of image (a). (d) Stripe
artifacts removed from image (b). (c) Cartesian transformation of image (d).</span><a class="headerlink" href="#fig-4-3-2" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</div></blockquote>
<section id="improvements">
<h2><span class="section-number">4.3.1. </span>Improvements<a class="headerlink" href="#improvements" title="Link to this heading">¶</a></h2>
<ul>
<li><p>Users can select different smoothing filters available in <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/ndimage.html">Scipy</a>
or in <a class="reference internal" href="../api/algotom.util.utility.html#api-util-utility"><span class="std std-ref">Algotom utility module</span></a> for removing stripes by passing keyword arguments as dict type:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">algotom.io.loadersaver</span> <span class="k">as</span> <span class="nn">losa</span>
<span class="kn">import</span> <span class="nn">algotom.prep.removal</span> <span class="k">as</span> <span class="nn">rem</span>
<span class="n">sinogram</span> <span class="o">=</span> <span class="n">losa</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="s2">&quot;D:/data/sinogram.tif&quot;</span><span class="p">)</span>
<span class="c1"># Sorting-based methods use the median filter by default, users can select</span>
<span class="c1"># another filter as below.</span>
<span class="n">sinogram1</span> <span class="o">=</span> <span class="n">rem</span><span class="o">.</span><span class="n">remove_stripe_based_sorting</span><span class="p">(</span><span class="n">sinogram</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;gaussian_filter&quot;</span><span class="p">,</span>
                                                              <span class="s2">&quot;para1&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">21</span><span class="p">)})</span>
</pre></div>
</div>
</li>
<li><p>The <a class="reference external" href="https://doi.org/10.1364/OE.26.028396">sorting-based technique</a>, which is simple but effective to remove
partial stripes and avoid void-center artifacts, is an option for other ring removal methods.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">sinogram2</span> <span class="o">=</span> <span class="n">rem</span><span class="o">.</span><span class="n">remove_stripe_based_filtering</span><span class="p">(</span><span class="n">sinogram</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sinogram3</span> <span class="o">=</span> <span class="n">rem</span><span class="o">.</span><span class="n">remove_stripe_based_regularization</span><span class="p">(</span><span class="n">sinogram</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="tools-for-designing-ring-removal-methods">
<h2><span class="section-number">4.3.2. </span>Tools for designing ring removal methods<a class="headerlink" href="#tools-for-designing-ring-removal-methods" title="Link to this heading">¶</a></h2>
<p>The cleaning capability with least side-effect of a ring removal method relies
on a smoothing filter or an interpolation technique which the method employs.
Other supporting techniques for revealing stripe artifacts such as sorting,
filtering, fitting, wavelet decomposition, polar transformation, or forward projection
are commonly used. Algotom provides these supporting tools for users to incorporate
with their own smoothing filters or interpolation techniques.</p>
<section id="back-and-forth-sorting">
<h3><span class="section-number">4.3.2.1. </span>Back-and-forth sorting<a class="headerlink" href="#back-and-forth-sorting" title="Link to this heading">¶</a></h3>
<blockquote>
<div><p>The technique (algorithm 3 in <span id="id1">[<a class="reference internal" href="../credits.html#id7" title="Nghia T. Vo, Robert C. Atwood, and Michael Drakopoulos. Superior techniques for eliminating ring artifacts in x-ray micro-tomography. Opt. Express, 26(22):28396–28412, Oct 2018. URL: http://www.opticsexpress.org/abstract.cfm?URI=oe-26-22-28396, doi:10.1364/OE.26.028396.">R19</a>]</span>) couples an image with an index array
for sorting the image backward and forward along an axis. Users can combine the
<a class="reference external" href="https://algotom.readthedocs.io/en/latest/toc/api/algotom.util.utility.html#algotom.util.utility.sort_forward">sorting forward</a>
method, a customized filter, and the <a class="reference external" href="https://algotom.readthedocs.io/en/latest/toc/api/algotom.util.utility.html#algotom.util.utility.sort_backward">sorting backward</a>
method as follows</p>
<figure class="align-center" id="fig-4-3-3" style="width: 70%">
<img alt="../../_images/fig_4_3_3.jpg" src="../../_images/fig_4_3_3.jpg" />
<figcaption>
<p><span class="caption-number">Fig. 4.3.3 </span><span class="caption-text">Demonstration of the forward sorting.</span><a class="headerlink" href="#fig-4-3-3" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">algotom.util.utility</span> <span class="k">as</span> <span class="nn">util</span>
<span class="kn">import</span> <span class="nn">scipy.ndimage</span> <span class="k">as</span> <span class="nn">ndi</span>

<span class="c1"># Sort forward</span>
<span class="n">sino_sort</span><span class="p">,</span> <span class="n">mat_index</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">sort_forward</span><span class="p">(</span><span class="n">sinogram</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Use a customized smoothing filter here</span>
<span class="n">sino_sort</span> <span class="o">=</span> <span class="n">apply_customized_filter</span><span class="p">(</span><span class="n">sino_sort</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
<span class="c1"># Sort backward</span>
<span class="n">sino_corr</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">sort_backward</span><span class="p">(</span><span class="n">sino_sort</span><span class="p">,</span> <span class="n">mat_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="fig-4-3-4" style="width: 70%">
<img alt="../../_images/fig_4_3_4.jpg" src="../../_images/fig_4_3_4.jpg" />
<figcaption>
<p><span class="caption-number">Fig. 4.3.4 </span><span class="caption-text">Demonstration of the backward sorting.</span><a class="headerlink" href="#fig-4-3-4" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</div></blockquote>
</section>
<section id="separation-of-frequency-components">
<h3><span class="section-number">4.3.2.2. </span>Separation of frequency components<a class="headerlink" href="#separation-of-frequency-components" title="Link to this heading">¶</a></h3>
<blockquote>
<div><p>The <a class="reference external" href="https://algotom.readthedocs.io/en/latest/toc/api/algotom.util.utility.html#algotom.util.utility.separate_frequency_component">technique</a>
can help to reveal stripe artifacts by separating frequency components of each image-column using a
1D window available in <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/signal.windows.html">Scipy</a>. Example
of how to use the technique:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="c1"># Separate a sinogram image</span>
<span class="n">sino_smooth</span><span class="p">,</span> <span class="n">sino_sharp</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">separate_frequency_component</span><span class="p">(</span><span class="n">sinogram</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                            <span class="n">window</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;gaussian&quot;</span><span class="p">,</span>
                                                                    <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>
<span class="c1"># Use a customized smoothing filter here</span>
<span class="n">sino_smooth_filtered</span> <span class="o">=</span> <span class="n">apply_customized_filter</span><span class="p">(</span><span class="n">sino_smooth</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
<span class="c1"># Add back</span>
<span class="n">sino_corr</span> <span class="o">=</span> <span class="n">sino_smooth_filtered</span> <span class="o">+</span> <span class="n">sino_sharp</span>
</pre></div>
</div>
<figure class="align-center" id="fig-4-3-5" style="width: 70%">
<img alt="../../_images/fig_4_3_5.jpg" src="../../_images/fig_4_3_5.jpg" />
<figcaption>
<p><span class="caption-number">Fig. 4.3.5 </span><span class="caption-text">Demonstration of how to separate frequency components of a sinogram along each column.</span><a class="headerlink" href="#fig-4-3-5" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</div></blockquote>
</section>
<section id="polynomial-fitting-along-an-axis">
<h3><span class="section-number">4.3.2.3. </span>Polynomial fitting along an axis<a class="headerlink" href="#polynomial-fitting-along-an-axis" title="Link to this heading">¶</a></h3>
<blockquote>
<div><p>The <a class="reference external" href="https://algotom.readthedocs.io/en/latest/toc/api/algotom.util.utility.html#algotom.util.utility.generate_fitted_image">technique</a>
can help to reveal low contrast stripes easily by applying a polynomial fit along each image-column.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">sino_fit</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">generate_fitted_image</span><span class="p">(</span><span class="n">sinogram</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_chunk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Use a customized smoothing filter here</span>
<span class="n">sino_smooth</span> <span class="o">=</span> <span class="n">apply_customized_filter</span><span class="p">(</span><span class="n">sino_fit</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
<span class="c1"># Get back the sinogram</span>
<span class="n">sino_corr</span> <span class="o">=</span> <span class="p">(</span><span class="n">sinogram</span> <span class="o">/</span> <span class="n">sino_fit</span><span class="p">)</span> <span class="o">*</span> <span class="n">sino_smooth</span>
</pre></div>
</div>
<figure class="align-center" id="fig-4-3-6" style="width: 70%">
<img alt="../../_images/fig_4_3_6.jpg" src="../../_images/fig_4_3_6.jpg" />
<figcaption>
<p><span class="caption-number">Fig. 4.3.6 </span><span class="caption-text">Demonstration of how to apply a polynomial fitting along each column of a sinogram.</span><a class="headerlink" href="#fig-4-3-6" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</div></blockquote>
</section>
<section id="wavelet-decomposition-and-reconstruction">
<h3><span class="section-number">4.3.2.4. </span>Wavelet decomposition and reconstruction<a class="headerlink" href="#wavelet-decomposition-and-reconstruction" title="Link to this heading">¶</a></h3>
<blockquote>
<div><p>Functions for <a class="reference external" href="https://algotom.readthedocs.io/en/latest/toc/api/algotom.util.utility.html#algotom.util.utility.apply_wavelet_decomposition">wavelet decomposition</a>,
<a class="reference external" href="https://algotom.readthedocs.io/en/latest/toc/api/algotom.util.utility.html#algotom.util.utility.apply_wavelet_reconstruction">wavelet reconstruction</a>,
and applying a smoothing filter to <a class="reference external" href="https://algotom.readthedocs.io/en/latest/toc/api/algotom.util.utility.html#algotom.util.utility.apply_filter_to_wavelet_component">specific levels</a>
of <a class="reference external" href="https://pywavelets.readthedocs.io/en/latest/">directional image-details</a> are provided.
The following codes decompose a sinogram to level 2. As can be seen in <a class="reference internal" href="#fig-4-3-7"><span class="std std-numref">Fig. 4.3.7</span></a>
stripe artifacts are visible in vertical details of results. One can apply a smoothing filter
to remove these stripes then apply a wavelet reconstruction to get the resulting sinogram.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">outputs</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">apply_wavelet_decomposition</span><span class="p">(</span><span class="n">sinogram</span><span class="p">,</span> <span class="s2">&quot;db9&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="p">[</span><span class="n">mat_2</span><span class="p">,</span> <span class="p">(</span><span class="n">cH_level_2</span><span class="p">,</span> <span class="n">cV_level_2</span><span class="p">,</span> <span class="n">cD_level_2</span><span class="p">),</span> <span class="p">(</span><span class="n">cH_level_1</span><span class="p">,</span> <span class="n">cV_level_1</span><span class="p">,</span> <span class="n">cD_level_1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">outputs</span>
<span class="c1"># Save results of vertical details</span>
<span class="c1"># losa.save_image(&quot;D:/output/cV_level_2.tif&quot;, cV_level_2)</span>
<span class="c1"># losa.save_image(&quot;D:/output/cV_level_1.tif&quot;, cV_level_1)</span>

<span class="c1"># Apply the gaussian filter to each level of vertical details</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">apply_filter_to_wavelet_component</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                                 <span class="n">method</span><span class="o">=</span><span class="s2">&quot;gaussian_filter&quot;</span><span class="p">,</span> <span class="n">para</span><span class="o">=</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)])</span>
<span class="c1"># Optional: remove stripes on the approximation image (mat_2 above)</span>
<span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">rem</span><span class="o">.</span><span class="n">remove_stripe_based_sorting</span><span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">11</span><span class="p">)</span>
<span class="c1"># Apply the wavelet reconstruction</span>
<span class="n">sino_corr</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">apply_wavelet_reconstruction</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="s2">&quot;db9&quot;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="fig-4-3-7" style="width: 90%">
<img alt="../../_images/fig_4_3_7.jpg" src="../../_images/fig_4_3_7.jpg" />
<figcaption>
<p><span class="caption-number">Fig. 4.3.7 </span><span class="caption-text">Demonstration of the wavelet decomposition.</span><a class="headerlink" href="#fig-4-3-7" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</div></blockquote>
</section>
<section id="stripe-interpolation">
<h3><span class="section-number">4.3.2.5. </span>Stripe interpolation<a class="headerlink" href="#stripe-interpolation" title="Link to this heading">¶</a></h3>
<blockquote>
<div><p>Users can design a customized stripe-detection method, then pass the result (as a 1D binary array) to the
following <a class="reference external" href="https://algotom.readthedocs.io/en/latest/toc/api/algotom.util.utility.html#algotom.util.utility.interpolate_inside_stripe">function</a>
to remove stripes by interpolation.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">sino_corr</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">interpolate_inside_stripe</span><span class="p">(</span><span class="n">sinogram</span><span class="p">,</span> <span class="n">list_mask</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="transformation-between-cartesian-and-polar-coordinate-system">
<h3><span class="section-number">4.3.2.6. </span>Transformation between Cartesian and polar coordinate system<a class="headerlink" href="#transformation-between-cartesian-and-polar-coordinate-system" title="Link to this heading">¶</a></h3>
<blockquote>
<div><p>This is a well-known technique to remove ring artifacts from a reconstructed image
as shown in <a class="reference internal" href="#fig-4-3-2"><span class="std std-numref">Fig. 4.3.2</span></a>.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">img_rec</span> <span class="o">=</span> <span class="n">losa</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="s2">&quot;D:/data/reconstructed_image.tif&quot;</span><span class="p">)</span>
<span class="c1"># Transform the reconstructed image into polar coordinates</span>
<span class="n">img_polar</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">transform_slice_forward</span><span class="p">(</span><span class="n">img_rec</span><span class="p">)</span>

<span class="c1"># Use a customized smoothing filter here</span>
<span class="n">img_corr</span> <span class="o">=</span> <span class="n">apply_customized_filter</span><span class="p">(</span><span class="n">img_polar</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>

<span class="c1"># Transform the resulting image into Cartesian coordinates</span>
<span class="n">img_carte</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">transform_slice_backward</span><span class="p">(</span><span class="n">img_corr</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="transformation-between-sinogram-space-and-reconstruction-space">
<h3><span class="section-number">4.3.2.7. </span>Transformation between sinogram space and reconstruction space<a class="headerlink" href="#transformation-between-sinogram-space-and-reconstruction-space" title="Link to this heading">¶</a></h3>
<blockquote>
<div><p>Algotom provides a <a class="reference external" href="https://algotom.readthedocs.io/en/latest/toc/api/algotom.util.simulation.html#algotom.util.simulation.make_sinogram">re-projection method</a>
to convert a reconstructed image to the sinogram image. As using directly the
Fourier slice theorem it’s fast compared to ray-tracing-based methods or
image-rotation-based methods.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">algotom.util.simulation</span> <span class="k">as</span> <span class="nn">sim</span>
<span class="kn">import</span> <span class="nn">algotom.rec.reconstruction</span> <span class="k">as</span> <span class="nn">rec</span>

<span class="n">rec_img</span> <span class="o">=</span> <span class="n">losa</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="s2">&quot;D:/data/reconstructed_image.tif&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">=</span> <span class="n">rec_img</span><span class="o">.</span><span class="n">shape</span>
<span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">180.0</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>

<span class="c1"># Re-project the reconstructed image</span>
<span class="n">sino_calc</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">make_sinogram</span><span class="p">(</span><span class="n">rec_img</span><span class="p">,</span> <span class="n">angles</span><span class="o">=</span><span class="n">angles</span><span class="p">)</span>

<span class="c1"># Use a customized stripe-removal method</span>
<span class="n">sino_corr</span> <span class="o">=</span> <span class="n">apply_customized_filter</span><span class="p">(</span><span class="n">sino_calc</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>

<span class="c1"># Reconstruct</span>
<span class="n">img_rec</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">dfi_reconstruction</span><span class="p">(</span><span class="n">sino_corr</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">apply_log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="fig-4-3-8" style="width: 80%">
<img alt="../../_images/fig_4_3_8.jpg" src="../../_images/fig_4_3_8.jpg" />
<figcaption>
<p><span class="caption-number">Fig. 4.3.8 </span><span class="caption-text">Demonstration of how to re-project a reconstructed image.</span><a class="headerlink" href="#fig-4-3-8" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</div></blockquote>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
    
        <div id="show_right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon">&lt;</span><span>Page contents</span></a></p>
        </div>

        <div id="right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon">&gt;</span><span>Page contents:</span></a></p>
            <div class="page_toc">
                <ul>
<li><a class="reference internal" href="#">4.3. Methods and tools for removing ring artifacts</a><ul>
<li><a class="reference internal" href="#improvements">4.3.1. Improvements</a></li>
<li><a class="reference internal" href="#tools-for-designing-ring-removal-methods">4.3.2. Tools for designing ring removal methods</a><ul>
<li><a class="reference internal" href="#back-and-forth-sorting">4.3.2.1. Back-and-forth sorting</a></li>
<li><a class="reference internal" href="#separation-of-frequency-components">4.3.2.2. Separation of frequency components</a></li>
<li><a class="reference internal" href="#polynomial-fitting-along-an-axis">4.3.2.3. Polynomial fitting along an axis</a></li>
<li><a class="reference internal" href="#wavelet-decomposition-and-reconstruction">4.3.2.4. Wavelet decomposition and reconstruction</a></li>
<li><a class="reference internal" href="#stripe-interpolation">4.3.2.5. Stripe interpolation</a></li>
<li><a class="reference internal" href="#transformation-between-cartesian-and-polar-coordinate-system">4.3.2.6. Transformation between Cartesian and polar coordinate system</a></li>
<li><a class="reference internal" href="#transformation-between-sinogram-space-and-reconstruction-space">4.3.2.7. Transformation between sinogram space and reconstruction space</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </div>
        </div>
    

      <div class="clearer"></div>
    </div>
    <div class="button_nav_wrapper">
        <div class="button_nav">
            <div class="left">
                
                <a href="section4_2.html">
                    <span class="icon">&lt;</span><span><span class="section-number">4.2. </span>Exploring raw data and making use of the input-output module</span></a>
                
            </div>

            <div class="right">
                
                    <a href="section4_4.html"><span><span class="section-number">4.4. </span>Comparison of ring removal methods on challenging sinograms</span><span class="icon">&gt;</span></a>
                
            </div>
        </div>
    </div>


    <div class="footer" role="contentinfo">
    &#169; Copyright 2021, Nghia T. Vo; NSLS-II, Brookhaven National Lab, US; Diamond Light Source, UK.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    </div>

<p id="theme_credit">Styled using the <a href="https://github.com/piccolo-orm/piccolo_theme">Piccolo Theme</a></p>
  </body>
</html>