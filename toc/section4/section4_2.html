<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>4.2. Exploring raw data and making use of the input-output module &#8212; Algotom&#39;s documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic_mod.css?v=9b2032db" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <script src="../../_static/js/petite-vue.js"></script>
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="4.3. Methods and tools for removing ring artifacts" href="section4_3.html" />
    <link rel="prev" title="4.1. Setting up a Python workspace" href="section4_1.html" /> 
  </head><body data-dark_mode_code_blocks="true">

<div id="top_nav">
    

    <nav>
        
            
        

        <p id="toggle_sidebar">
            <a href="#" title="Toggle sidebar">|||</a>
        </p>
        <h1><a href="../../index.html" title="Go to homepage">Algotom's documentation</a></h1>

        <a id="mode_toggle" href="#" @click.prevent="handleClick" :title="mode">
    <template v-if="mode == 'light'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_light"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M67.48,18.073c1.913,-1.912 1.913,-5.018 0,-6.931c-1.912,-1.912 -5.018,-1.912 -6.931,0l-6.798,6.799c-1.912,1.912 -1.912,5.018 0,6.931c1.913,1.912 5.018,1.912 6.931,-0l6.798,-6.799Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.728,61.108c1.912,-1.913 1.912,-5.018 -0,-6.931c-1.913,-1.913 -5.019,-1.913 -6.931,-0l-6.799,6.798c-1.912,1.913 -1.912,5.019 0,6.931c1.913,1.913 5.019,1.913 6.931,0l6.799,-6.798Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.682,54.177c-1.913,-1.913 -5.018,-1.913 -6.931,-0c-1.912,1.913 -1.912,5.018 0,6.931l6.798,6.798c1.913,1.913 5.019,1.913 6.931,0c1.913,-1.912 1.913,-5.018 0,-6.931l-6.798,-6.798Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M4.901,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,-0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M18.929,11.142c-1.912,-1.912 -5.018,-1.912 -6.931,0c-1.912,1.913 -1.912,5.019 0,6.931l6.799,6.799c1.912,1.912 5.018,1.912 6.931,-0c1.912,-1.913 1.912,-5.019 -0,-6.931l-6.799,-6.799Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.108,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c-0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c-0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'dark'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_dark"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.901,2.196 -4.901,4.901c0,2.705 2.197,4.901 4.901,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.662,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.989,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.732,61.103c1.91,-1.91 1.91,-5.011 0,-6.921l-0.009,-0.01c-1.91,-1.91 -5.012,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.909,1.91 5.011,1.91 6.92,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.672,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.52,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l-0,-0.01c-0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.901,2.196 -4.901,4.901c0,2.704 2.197,4.9 4.901,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.73,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 -0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.098,34.623c-2.699,0 -4.891,2.192 -4.891,4.892l-0,0.019c-0,2.699 2.192,4.891 4.891,4.891c2.7,0 4.892,-2.192 4.892,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.892,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'darkest'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_darkest"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><path d="M39.315,23.791c8.684,-0 15.734,7.05 15.734,15.733c0,8.684 -7.05,15.734 -15.734,15.734c-8.683,0 -15.733,-7.05 -15.733,-15.734c-0,-8.683 7.05,-15.733 15.733,-15.733Zm0,4.737c6.069,0 10.997,4.927 10.997,10.996c-0,6.069 -4.928,10.996 -10.997,10.996c-6.068,0 -10.996,-4.927 -10.996,-10.996c0,-6.069 4.928,-10.996 10.996,-10.996Z" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.216,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.9,2.196 -4.9,4.901c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.666,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.99,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.737,61.103c1.909,-1.91 1.909,-5.011 -0,-6.921l-0.01,-0.01c-1.91,-1.91 -5.011,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.91,1.91 5.011,1.91 6.921,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.676,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.524,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l0,-0.01c0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.216,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901c-0,2.704 2.196,4.9 4.9,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.734,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.103,34.623c-2.7,0 -4.892,2.192 -4.892,4.892l-0,0.019c-0,2.699 2.192,4.891 4.892,4.891c2.699,0 4.891,-2.192 4.891,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.891,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>
</a>

<script>
(function() {
    const LOCAL_STORAGE_KEY = 'piccoloThemeMode'

    var initialMode = localStorage.getItem(LOCAL_STORAGE_KEY)

    if (initialMode) {
        // Make sure the value in local storage is valid
        if (['light', 'dark', 'darkest'].indexOf(initialMode) == -1) {
            initialMode = 'light'
            localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
        }
    } else {
        // Check if the client prefers dark mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            initialMode = 'dark'
        } else {
            initialMode = 'light'
        }
        localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
    }

    document.documentElement.dataset.mode = initialMode

    PetiteVue.createApp({
        'mode': initialMode,
        handleClick() {
            let currentMode = this.mode

            if (currentMode == 'light') {
                this.mode = 'dark'
            } else if (currentMode == 'dark') {
                this.mode = 'darkest'
            } else if (currentMode == 'darkest') {
                this.mode = 'light'
            }

            document.documentElement.dataset.mode = this.mode
            localStorage.setItem(LOCAL_STORAGE_KEY, this.mode)

            console.log(this.mode)
        }
    }).mount('#mode_toggle')
})()
</script>
            <p class="mobile_search_link">
                <a href="../../search.html" title="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 65 64" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2">
                        <path d="M14.873 40.009c-2.315-3.943-3.642-8.532-3.642-13.429C11.231 11.91 23.141 0 37.811 0s26.58 11.91 26.58 26.58-11.91 26.58-26.58 26.58a26.44 26.44 0 0 1-14.277-4.161L9.739 62.794a3.12 3.12 0 0 1-4.413 0L.913 58.382c-1.217-1.218-1.217-3.196 0-4.413l13.96-13.96zM37.811 8.054c10.225 0 18.526 8.301 18.526 18.526s-8.301 18.526-18.526 18.526-18.526-8.301-18.526-18.526S27.586 8.054 37.811 8.054z" fill="#fff" />
                    </svg>
                </a>
            </p>
        

        <div class="searchbox_wrapper">
            
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
    </nav>
</div>

    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../section1.html">1. Basic tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../section2.html">2. Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../section3.html">3. Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../section4.html">4. Demonstrations</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="section4_1.html">4.1. Setting up a Python workspace</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.2. Exploring raw data and making use of the input-output module</a></li>
<li class="toctree-l2"><a class="reference internal" href="section4_3.html">4.3. Methods and tools for removing ring artifacts</a></li>
<li class="toctree-l2"><a class="reference internal" href="section4_4.html">4.4. Comparison of ring removal methods on challenging sinograms</a></li>
<li class="toctree-l2"><a class="reference internal" href="section4_5.html">4.5. Complete workflow for processing tomographic data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../section5.html">5. Technical notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../section6.html">6. Update notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">7. API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits.html">8. Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../highlights.html">9. Highlights</a></li>
<li class="toctree-l1"><a class="reference internal" href="../links.html">10. Quick links</a></li>
</ul>

        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="exploring-raw-data-and-making-use-of-the-input-output-module">
<h1><span class="section-number">4.2. </span>Exploring raw data and making use of the input-output module<a class="headerlink" href="#exploring-raw-data-and-making-use-of-the-input-output-module" title="Link to this heading">¶</a></h1>
<p>The following sections show how to handle different types of raw data before
they can be used for processing and reconstruction.</p>
<section id="nxs-hdf-files">
<h2><span class="section-number">4.2.1. </span>Nxs/hdf files<a class="headerlink" href="#nxs-hdf-files" title="Link to this heading">¶</a></h2>
<p>A nxs/hdf file can contain multiple datasets and data-types. Generally speaking,
it likes a folder with many sub-folders and files inside (i.e. hierarchical format).
To get data from a hdf file we need to know the path to the data. For example, we
want to know the path to projection-images of this <a class="reference external" href="https://doi.org/10.5281/zenodo.1443567">tomographic data</a>.
The data have two files: a hdf file which contains images recorded by a detector and
a nxs file which contains the metadata of the experiment. The hdf file was
<a class="reference external" href="https://docs.h5py.org/en/stable/high/group.html#external-links">linked</a> to the nxs
file at the time they were created, so we only need to work with the nxs file.</p>
<ul>
<li><p>Using <a class="reference external" href="https://portal.hdfgroup.org/display/support/Download+HDFView">Hdfview</a>
(version 2.14 is easy to install) we can find the path to image data is <em>“/entry1/tomo_entry/data/data”</em>.
To display an image in that dataset: right click on “data” -&gt; select “Open as” -&gt; select “dim1”
for “Height”, select “dim2” for “Width” -&gt; click “OK”.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/fig_4_2_1.png" id="fig-4-2-1"><img alt="../../_images/fig_4_2_1.png" class="align-center" id="fig-4-2-1" src="../../_images/fig_4_2_1.png" style="width: 100%;" />
</a>
</div></blockquote>
<p>A metadata we need to know is rotation angles corresponding to the acquired images. The
path to this data is <em>“/entry1/tomo_entry/data/rotation_angle”</em>. There are three types
of images in a tomographic dataset: images with sample (projection), images without sample
(flat-field or white field), and images taken with a photon source off (dark-field). In the
data used for this demonstration, there’s a metadata in <em>“/entry1/instrument/image_key/image_key”</em>
used to indicate the type of an image: 0 &lt;-&gt; projection; 1 &lt;-&gt; flat-field;
2 &lt;-&gt; dark-field.</p>
<p>Different tomography facilities name above datasets differently. Some names rotation angles
as “theta_angle”. Some record flat-field and dark-field images as separate datasets (<a class="reference internal" href="../section1/section1_4.html#fig-1-4-1"><span class="std std-numref">Fig. 1.4.1</span></a>).
There has been an effort to unify these terms for synchrotron-based tomography community. This will be
very userful for end-users where they can use the same codes for processing data acquired at
different facilities.</p>
</li>
<li><p>Other way of exploring nxs/hdf files is to use <a class="reference external" href="https://nexpy.github.io/nexpy/">NeXpy</a>.
Users need to install NeXpy in an activated <a class="reference internal" href="section4_1.html#section4-1"><span class="std std-ref">environment</span></a>.</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">conda install -c conda-forge nexpy</span>
</pre></div>
</div>
</div></blockquote>
<p>and run from that environment</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/fig_4_2_2.png" id="fig-4-2-2"><img alt="../../_images/fig_4_2_2.png" class="align-center" id="fig-4-2-2" src="../../_images/fig_4_2_2.png" style="width: 70%;" />
</a>
</div></blockquote>
<p>NeXpy provides more options to explore data. Noting that image in NeXpy
is displayed with the origin at the bottom left. This is different to Hdfview (<a class="reference internal" href="../section1/section1_4.html#fig-1-4-2"><span class="std std-numref">Fig. 1.4.2</span></a>).</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/fig_4_2_3.png" id="fig-4-2-3"><img alt="../../_images/fig_4_2_3.png" class="align-center" id="fig-4-2-3" src="../../_images/fig_4_2_3.png" style="width: 100%;" />
</a>
</div></blockquote>
<p>Other python-based GUI software can be used are: <a class="reference external" href="https://github.com/algotom/datview">Datview</a>, <a class="reference external" href="https://github.com/algotom/broh5">Broh5</a> or
<a class="reference external" href="https://github.com/uvemas/ViTables">Vitables</a>.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/fig_4_2_4.png" id="fig-4-2-4"><img alt="../../_images/fig_4_2_4.png" class="align-center" id="fig-4-2-4" src="../../_images/fig_4_2_4.png" style="width: 100%;" />
</a>
</div></blockquote>
</li>
<li><p>Users also can use functions in the <a class="reference internal" href="../api.html#input-output"><span class="std std-ref">input-output module</span></a> of Algotom to explore data.
For example, to display the hierarchical structure of a hdf file:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">algotom.io.loadersaver</span> <span class="k">as</span> <span class="nn">losa</span>

<span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;E:/Tomo_data/68067.nxs&quot;</span>
<span class="n">losa</span><span class="o">.</span><span class="n">get_hdf_tree</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Output:</span>
<span class="go">entry1</span>
<span class="go">    │</span>
<span class="go">    ├── before_scan</span>
<span class="go">    │   │</span>
<span class="go">    │   ├── cam1</span>
<span class="go">    │   │   │</span>
<span class="go">    │   │   ├── cam1_roll (1,)</span>
<span class="go">    │   │   ├── cam1_x (1,)</span>
<span class="go">    │   │   └── cam1_z (1,)</span>
<span class="go">    │   ├── dcm1_cap_1</span>
<span class="go">    │   │   └── dcm1_cap_1 (1,)</span>
</pre></div>
</div>
</div></blockquote>
<p>To find datasets having the pattern of “data” in their paths:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">keys</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">types</span> <span class="o">=</span> <span class="n">losa</span><span class="o">.</span><span class="n">find_hdf_key</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s2">&quot; Key: </span><span class="si">{0}</span><span class="s2"> | Shape: </span><span class="si">{1}</span><span class="s2"> | Type: </span><span class="si">{2}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">shapes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">types</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Output:</span>
<span class="go">0  Key: entry1/flyScanDetector/data | Shape: (1861, 2160, 2560) | Type: uint16</span>
<span class="go">1  Key: entry1/instrument/flyScanDetector/data | Shape: (1861, 2160, 2560) | Type: uint16</span>
<span class="go">2  Key: entry1/tomo_entry/data | Shape: None | Type: None</span>
<span class="go">3  Key: entry1/tomo_entry/control/data | Shape: (1,) | Type: float64</span>
<span class="go">4  Key: entry1/tomo_entry/data/data | Shape: (1861, 2160, 2560) | Type: uint16</span>
<span class="go">5  Key: entry1/tomo_entry/data/rotation_angle | Shape: (1861,) | Type: float64</span>
<span class="go">6  Key: entry1/tomo_entry/instrument/detector/data | Shape: (1861, 2160, 2560) | Type: uint16</span>
</pre></div>
</div>
</div></blockquote>
<p>After knowing the path (key) to a dataset containing images we can extract an image and save it as tif. A
convenient feature of methods for saving data in Algotom is that if the output folder doesn’t exist
it will be created.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">image_data</span> <span class="o">=</span> <span class="n">losa</span><span class="o">.</span><span class="n">load_hdf</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;entry1/tomo_entry/data/data&quot;</span><span class="p">)</span>
<span class="n">losa</span><span class="o">.</span><span class="n">save_image</span><span class="p">(</span><span class="s2">&quot;E:/output/image_00100.tif&quot;</span><span class="p">,</span> <span class="n">image_data</span><span class="p">[</span><span class="mi">100</span><span class="p">])</span>
</pre></div>
</div>
</div></blockquote>
<p>We also can extract multiple images from a hdf file and save them to tiff using a single command</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">algotom.io.converter</span> <span class="k">as</span> <span class="nn">conv</span>

<span class="c1"># Extract images with the indices of (start, stop, step) along axis 0</span>
<span class="n">conv</span><span class="o">.</span><span class="n">extract_tif_from_hdf</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;E:/output/some_proj/&quot;</span><span class="p">,</span> <span class="s2">&quot;entry1/tomo_entry/data/data&quot;</span><span class="p">,</span>
                          <span class="n">index</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">crop</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;proj&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</section>
<section id="tiff-files">
<h2><span class="section-number">4.2.2. </span>Tiff files<a class="headerlink" href="#tiff-files" title="Link to this heading">¶</a></h2>
<p>In some tomography systems, raw data are saved as tiff images. As shown in <a class="reference internal" href="../section2.html#section2"><span class="std std-ref">section 2</span></a>,
processing methods for tomographic data work either on projection space or sinogram space, or on both.
Because of that, we have to switch between spaces, i.e. slicing 3D data along different axis. This
cannot be done efficiently if using the tiff format. In such case, users can convert tiff images to
the hdf format first before processing them with options to add metadata.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">input_folder</span> <span class="o">=</span> <span class="s2">&quot;E:/raw_tif/&quot;</span> <span class="c1"># Folder with tiff files inside. Note that the names of the</span>
                             <span class="c1"># tiff files must be corresponding to the increasing order of angles</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;E:/convert_hdf/tomo_data.hdf&quot;</span>
<span class="n">num_angle</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">losa</span><span class="o">.</span><span class="n">file_file</span><span class="p">(</span><span class="n">input_folder</span> <span class="o">+</span> <span class="s2">&quot;/*tif*&quot;</span><span class="p">))</span>
<span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">180.0</span><span class="p">,</span> <span class="n">num_angle</span><span class="p">)</span>
<span class="n">conv</span><span class="o">.</span><span class="n">convert_tif_to_hdf</span><span class="p">(</span><span class="n">input_folder</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">key_path</span><span class="o">=</span><span class="s1">&#39;entry/data&#39;</span><span class="p">,</span>
                        <span class="n">crop</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;entry/angles&quot;</span><span class="p">:</span> <span class="n">angles</span><span class="p">,</span> <span class="s2">&quot;entry/energy_keV&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span>
</pre></div>
</div>
</div></blockquote>
<p>In some cases, we may want to load a stack of tiff images and average them such as flat-field images or
dark-field images. This can be done in different ways</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">input_folder</span> <span class="o">=</span> <span class="s2">&quot;E:/flat_field/&quot;</span>
<span class="c1"># 1st way</span>
<span class="n">flat_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">losa</span><span class="o">.</span><span class="n">get_tif_stack</span><span class="p">(</span><span class="n">input_folder</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">crop</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># 2nd way. The method was written for speckle-tracking tomography but can be used here</span>
<span class="n">flat_field</span> <span class="o">=</span> <span class="n">losa</span><span class="o">.</span><span class="n">get_image_stack</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">input_folder</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crop</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="c1"># 3rd way</span>
<span class="n">list_file</span> <span class="o">=</span> <span class="n">losa</span><span class="o">.</span><span class="n">find_file</span><span class="p">(</span><span class="n">input_folder</span> <span class="o">+</span> <span class="s2">&quot;/*tif*&quot;</span><span class="p">)</span>
<span class="n">flat_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">losa</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">list_file</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="mrc-files">
<h2><span class="section-number">4.2.3. </span>Mrc files<a class="headerlink" href="#mrc-files" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://www.ccpem.ac.uk/mrc_format/mrc_format.php">Mrc format</a> is a standard format in electron tomography.
To load this data, users need to install the <a class="reference external" href="https://pypi.org/project/mrcfile/">Mrcfile library</a></p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">conda install -c conda-forge mrcfile</span>
</pre></div>
</div>
</div></blockquote>
<p>and check the <a class="reference external" href="https://mrcfile.readthedocs.io/en/stable/">documentation page</a> to know how to extract
data and metadata from this format. For large files, we use memory-mapped mode to read only part
of data needed as shown below.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mrcfile</span>
<span class="kn">import</span> <span class="nn">algotom.io.loadersaver</span> <span class="k">as</span> <span class="nn">losa</span>

<span class="n">mrc</span> <span class="o">=</span> <span class="n">mrcfile</span><span class="o">.</span><span class="n">mmap</span><span class="p">(</span><span class="s2">&quot;E:/etomo/tomo.mrc&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r+&#39;</span><span class="p">)</span>
<span class="n">output_base</span> <span class="o">=</span> <span class="s2">&quot;E:/output&quot;</span>
<span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;0000&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">losa</span><span class="o">.</span><span class="n">save_image</span><span class="p">(</span><span class="n">output_base</span> <span class="o">+</span> <span class="s2">&quot;/img_&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span> <span class="o">+</span> <span class="s2">&quot;.tif&quot;</span><span class="p">,</span> <span class="n">mrc</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
</div></blockquote>
<p>Methods in Algotom assume that the rotation axis of a tomographic data is parallel to the columns of
an image. Users may need to rotate images loaded from a mrc file because the rotation axis is often
parallel to image-rows instead.</p>
</section>
<section id="other-file-formats">
<h2><span class="section-number">4.2.4. </span>Other file formats<a class="headerlink" href="#other-file-formats" title="Link to this heading">¶</a></h2>
<p>For other file formats such as xrm, txrm, fits, … users can use the <a class="reference external" href="https://github.com/data-exchange/dxchange">DXchange library</a>
to load data</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">conda install -c conda-forge dxchange</span>
</pre></div>
</div>
</div></blockquote>
<p>and refer <a class="reference external" href="http://dxchange.readthedocs.io/">the documentation page</a> for more details.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
    
        <div id="show_right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon">&lt;</span><span>Page contents</span></a></p>
        </div>

        <div id="right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon">&gt;</span><span>Page contents:</span></a></p>
            <div class="page_toc">
                <ul>
<li><a class="reference internal" href="#">4.2. Exploring raw data and making use of the input-output module</a><ul>
<li><a class="reference internal" href="#nxs-hdf-files">4.2.1. Nxs/hdf files</a></li>
<li><a class="reference internal" href="#tiff-files">4.2.2. Tiff files</a></li>
<li><a class="reference internal" href="#mrc-files">4.2.3. Mrc files</a></li>
<li><a class="reference internal" href="#other-file-formats">4.2.4. Other file formats</a></li>
</ul>
</li>
</ul>

            </div>
        </div>
    

      <div class="clearer"></div>
    </div>
    <div class="button_nav_wrapper">
        <div class="button_nav">
            <div class="left">
                
                <a href="section4_1.html">
                    <span class="icon">&lt;</span><span><span class="section-number">4.1. </span>Setting up a Python workspace</span></a>
                
            </div>

            <div class="right">
                
                    <a href="section4_3.html"><span><span class="section-number">4.3. </span>Methods and tools for removing ring artifacts</span><span class="icon">&gt;</span></a>
                
            </div>
        </div>
    </div>


    <div class="footer" role="contentinfo">
    &#169; Copyright 2021, Nghia T. Vo; NSLS-II, Brookhaven National Lab, US; Diamond Light Source, UK.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    </div>

<p id="theme_credit">Styled using the <a href="https://github.com/piccolo-orm/piccolo_theme">Piccolo Theme</a></p>
  </body>
</html>